import https from 'https';
import fs from 'fs';
import path from 'path';
import url from 'url'

//

const __filename = url.fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

//

const fileURL = 'https://www.unicode.org/Public/security/latest/confusables.txt';
const outputFilename = 'confusables.ts';
const outputDir = path.resolve(__dirname, '../src/ConfusablesParser', outputFilename);
const outputPath = path.resolve(outputDir, outputFilename);

if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true });
}

//

console.log(`ğŸ” Fetching the latest 'confusables.txt' file from Unicode...`);

https.get(fileURL, (res) => {
    if (res.statusCode !== 200) {
        console.error(`âŒ Fetching Error, statusCode: ${res.statusCode}`);
        res.resume();
        return;
    }

    let data = '';
    res.on('data', (chunk) => { data += chunk; });
    res.on('end', () => {
        const fileBodyLines = [
            `// this file is generated by scripts/update-confusables.js`,
            ``,
            `export default ${JSON.stringify(data)};`
        ];

        fs.writeFileSync(outputPath, fileBodyLines.join("\n"), 'utf8');
        console.log(`âœ… File ${outputFilename} saved to ${outputPath}`);
    });
}).on('error', (err) => {
    console.error(`âŒ Error downloading file: ${err.message}`);
});